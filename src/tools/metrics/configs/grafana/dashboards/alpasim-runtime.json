{
    "annotations": {
      "list": [
        {
          "builtIn": 1,
          "datasource": {
            "type": "grafana",
            "uid": "-- Grafana --"
          },
          "enable": true,
          "hide": true,
          "iconColor": "rgba(0, 211, 255, 1)",
          "name": "Annotations & Alerts",
          "type": "dashboard"
        }
      ]
    },
    "description": "Shows static performance data for all Alpasim runtime API calls for a test run or runs. ",
    "editable": true,
    "fiscalYearStartMonth": 0,
    "graphTooltip": 0,
    "id": 1,
    "links": [],
    "liveNow": true,
    "panels": [
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 0
        },
        "id": 4,
        "panels": [],
        "title": "Overview",
        "type": "row"
      },
      {
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "gridPos": {
          "h": 8,
          "w": 24,
          "x": 0,
          "y": 1
        },
        "id": 3,
        "options": {
          "code": {
            "language": "plaintext",
            "showLineNumbers": false,
            "showMiniMap": false
          },
          "content": "# Using this dashboard  \n\nThis is a basic dashboard for viewing the API performance of a test run or test runs of Alpasim Runtime.\n\nChoose the service and (optionally) method from the dropdowns above to show the average request duration for selected service + method combinations.\n\n## Viewing data for multiple runs\nThis dashboard is designed for a single run, as it works with averages and not time series data. Multiple runs _can_ be ingested into prometheus bu providing multiple *.prom files, but change over time will not be shown here.\n\n# Updating the dashboard\nThis dashboard is stored in the alpasim-runtime repo at `tools/metrics/configs/grafana/dashboards/alpasim-runtime.json`. To make changes, change the dashboard in Grafana and click \"Save dashboard\" where you will be shown the JSON. Paste the JSON into that file and open an MR to commit changes for everyone.",
          "mode": "markdown"
        },
        "pluginVersion": "11.4.0",
        "title": "",
        "type": "text"
      },
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 9
        },
        "id": 2,
        "panels": [],
        "repeat": "service",
        "title": "Average request duration for $service service",
        "type": "row"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "P1809F7CD0C75ACF3"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "displayName": "$method",
            "fieldMinMax": false,
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "super-light-green",
                  "value": null
                }
              ]
            },
            "unit": "s"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 10,
          "w": 24,
          "x": 0,
          "y": 10
        },
        "id": 1,
        "interval": "1s",
        "maxPerRow": 8,
        "options": {
          "colorMode": "value",
          "graphMode": "none",
          "justifyMode": "center",
          "orientation": "auto",
          "percentChangeColorMode": "standard",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "",
            "values": false
          },
          "showPercentChange": false,
          "textMode": "auto",
          "wideLayout": true
        },
        "pluginVersion": "11.4.0",
        "repeat": "method",
        "repeatDirection": "h",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "P1809F7CD0C75ACF3"
            },
            "disableTextWrap": false,
            "editorMode": "builder",
            "exemplar": false,
            "expr": "sum by(service, method) (request_latency_seconds_sum{service=~\"$service\", method=~\"$method\"}) / sum by(service, method) (request_latency_seconds_count{service=~\"$service\", method=~\"$method\"})",
            "format": "table",
            "fullMetaSearch": false,
            "includeNullMetadata": true,
            "instant": true,
            "interval": "1s",
            "legendFormat": "__auto",
            "range": false,
            "refId": "A",
            "useBackend": false
          }
        ],
        "title": "",
        "transparent": true,
        "type": "stat"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "P1809F7CD0C75ACF3"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "displayName": "$method",
            "mappings": [],
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "super-light-green",
                  "value": null
                }
              ]
            },
            "unit": "none"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 10,
          "w": 24,
          "x": 0,
          "y": 20
        },
        "id": 6,
        "maxPerRow": 8,
        "options": {
          "colorMode": "value",
          "graphMode": "none",
          "justifyMode": "center",
          "orientation": "auto",
          "percentChangeColorMode": "standard",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "",
            "values": false
          },
          "showPercentChange": false,
          "textMode": "auto",
          "wideLayout": true
        },
        "pluginVersion": "11.4.0",
        "repeat": "method",
        "repeatDirection": "h",
        "targets": [
          {
            "disableTextWrap": false,
            "editorMode": "builder",
            "exemplar": false,
            "expr": "sum by(service, method) (request_latency_seconds_count{service=~\"$service\", method=~\"$method\"})",
            "format": "table",
            "fullMetaSearch": false,
            "includeNullMetadata": true,
            "instant": true,
            "interval": "1s",
            "legendFormat": "__auto",
            "range": false,
            "refId": "A",
            "useBackend": false
          }
        ],
        "title": "# of service calls",
        "type": "stat"
      }
    ],
    "preload": true,
    "refresh": "5s",
    "schemaVersion": 40,
    "tags": [],
    "templating": {
      "list": [
        {
          "current": {
            "text": "driver",
            "value": "driver"
          },
          "definition": "label_values(request_latency_seconds_bucket,service)",
          "description": "",
          "includeAll": false,
          "label": "Service",
          "name": "service",
          "options": [],
          "query": {
            "qryType": 1,
            "query": "label_values(request_latency_seconds_bucket,service)",
            "refId": "PrometheusVariableQueryEditor-VariableQuery"
          },
          "refresh": 1,
          "regex": "",
          "sort": 5,
          "type": "query"
        },
        {
          "current": {
            "text": "All",
            "value": "$__all"
          },
          "definition": "label_values(request_latency_seconds_bucket{service=~\"$service\"},method)",
          "includeAll": true,
          "label": "Method",
          "name": "method",
          "options": [],
          "query": {
            "qryType": 1,
            "query": "label_values(request_latency_seconds_bucket{service=~\"$service\"},method)",
            "refId": "PrometheusVariableQueryEditor-VariableQuery"
          },
          "refresh": 1,
          "regex": "",
          "type": "query"
        }
      ]
    },
    "time": {
      "from": "now-6h",
      "to": "now"
    },
    "timepicker": {
        "hidden": true
    },
    "timezone": "browser",
    "title": "Alpasim Runtime Performance",
    "uid": "ae6f6s9ka0ao0d",
    "version": 4,
    "weekStart": ""
  }
